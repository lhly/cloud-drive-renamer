# CloudDrive Renamer

<div align="center">

**ä¸€æ¬¾å¼ºå¤§çš„äº‘ç›˜æ–‡ä»¶æ‰¹é‡é‡å‘½åå·¥å…·**

æ”¯æŒå¤¸å…‹ç½‘ç›˜ã€é˜¿é‡Œäº‘ç›˜(å¾…å¼€å‘)ã€ç™¾åº¦ç½‘ç›˜(å¾…å¼€å‘)çš„æ™ºèƒ½åŒ–æ–‡ä»¶ç®¡ç†

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.3+-blue.svg)](https://www.typescriptlang.org/)
[![Chrome Extension](https://img.shields.io/badge/Chrome-Extension-green.svg)](https://developer.chrome.com/docs/extensions/)

</div>

---

## ğŸ“– ç›®å½•

- [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [åŠŸèƒ½è¯¦è§£](#åŠŸèƒ½è¯¦è§£)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [äºŒæ¬¡å¼€å‘](#äºŒæ¬¡å¼€å‘)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [è®¸å¯åè®®](#è®¸å¯åè®®)

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ å¤šå¹³å°æ”¯æŒ

- **å¤¸å…‹ç½‘ç›˜** - å®Œå…¨æ”¯æŒï¼Œå¯ç«‹å³ä½¿ç”¨
- **é˜¿é‡Œäº‘ç›˜** - æ¶æ„å·²å°±ç»ªï¼Œæ‰©å±•ä¸­
- **ç™¾åº¦ç½‘ç›˜** - æ¶æ„å·²å°±ç»ªï¼Œæ‰©å±•ä¸­

### ğŸ”§ å¼ºå¤§çš„é‡å‘½åè§„åˆ™

#### 1. æ›¿æ¢è§„åˆ™ (Replace)
æ‰¹é‡æ›¿æ¢æ–‡ä»¶åä¸­çš„ç‰¹å®šæ–‡æœ¬ï¼Œæ”¯æŒå¤§å°å†™æ•æ„Ÿå’Œå…¨å±€æ›¿æ¢ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- ç»Ÿä¸€ä¿®æ”¹æ–‡ä»¶å‰ç¼€ï¼š`file-v1` â†’ `file-v2`
- æ›¿æ¢ä¸è§„èŒƒå‘½åï¼š`IMG_` â†’ `Photo_`

**é…ç½®å‚æ•°**ï¼š
```typescript
{
  search: string;        // è¦æŸ¥æ‰¾çš„æ–‡æœ¬
  replace: string;       // æ›¿æ¢ä¸ºçš„æ–‡æœ¬
  caseSensitive: boolean; // æ˜¯å¦åŒºåˆ†å¤§å°å†™
  global: boolean;       // æ˜¯å¦å…¨å±€æ›¿æ¢
}
```

#### 2. å‰ç¼€è§„åˆ™ (Prefix)
ä¸ºæ‰€æœ‰æ–‡ä»¶æ·»åŠ ç»Ÿä¸€å‰ç¼€ï¼Œå¯è‡ªå®šä¹‰åˆ†éš”ç¬¦ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ ‡è®°é¡¹ç›®å½’å±ï¼šæ·»åŠ  `Project-A_`
- æ·»åŠ æ—¥æœŸæ ‡è®°ï¼šæ·»åŠ  `2025-01-`

**é…ç½®å‚æ•°**ï¼š
```typescript
{
  prefix: string;    // å‰ç¼€æ–‡æœ¬
  separator: string; // åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºç©º
}
```

#### 3. åç¼€è§„åˆ™ (Suffix)
ä¸ºæ–‡ä»¶åï¼ˆæ‰©å±•åä¹‹å‰ï¼‰æ·»åŠ åç¼€æ ‡è®°ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ·»åŠ ç‰ˆæœ¬æ ‡è®°ï¼š`document` â†’ `document_v2`
- æ ‡æ³¨å¤„ç†çŠ¶æ€ï¼š`image` â†’ `image_processed`

**é…ç½®å‚æ•°**ï¼š
```typescript
{
  suffix: string;    // åç¼€æ–‡æœ¬
  separator: string; // åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºç©º
}
```

#### 4. ç¼–å·è§„åˆ™ (Numbering)
è‡ªåŠ¨ä¸ºæ–‡ä»¶æ·»åŠ åºå·ï¼Œæ”¯æŒè‡ªå®šä¹‰æ ¼å¼ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- ç…§ç‰‡æ•´ç†ï¼š`photo` â†’ `photo_001`, `photo_002`
- æ–‡æ¡£æ’åºï¼š`Chapter` â†’ `001_Chapter`, `002_Chapter`

**é…ç½®å‚æ•°**ï¼š
```typescript
{
  startNumber: number;              // èµ·å§‹ç¼–å·
  digits: number;                   // ä½æ•°ï¼ˆè¡¥é›¶ï¼‰
  position: 'prefix' | 'suffix';    // ç¼–å·ä½ç½®
  format: string;                   // æ ¼å¼åŒ–æ¨¡æ¿
  separator: string;                // åˆ†éš”ç¬¦
}
```

#### 5. æ¸…ç†è§„åˆ™ (Sanitize)
æ¸…é™¤æ–‡ä»¶åä¸­çš„éæ³•å­—ç¬¦æˆ–ç‰¹å®šå­—ç¬¦é›†ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- ç§»é™¤ç‰¹æ®Šç¬¦å·ï¼š`file@#$` â†’ `file`
- æ¸…ç†ç©ºæ ¼å’Œæ ‡ç‚¹ï¼š`my file!.txt` â†’ `myfile.txt`

**é…ç½®å‚æ•°**ï¼š
```typescript
{
  removeChars: string;    // è¦ç§»é™¤çš„å­—ç¬¦é›†
  removeIllegal: boolean; // æ˜¯å¦ç§»é™¤éæ³•å­—ç¬¦
}
```

### ğŸš€ æ™ºèƒ½æ‰§è¡Œå¼•æ“

#### æ‰¹é‡å¤„ç†ç³»ç»Ÿ
- **é€Ÿç‡æ§åˆ¶**ï¼š800ms é—´éš”æ‰§è¡Œï¼Œé˜²æ­¢ API é™æµ
- **é‡è¯•æœºåˆ¶**ï¼šæŒ‡æ•°é€€é¿ç®—æ³•ï¼Œè‡ªåŠ¨é‡è¯•å¤±è´¥æ“ä½œ
- **å´©æºƒæ¢å¤**ï¼šå¼‚å¸¸ä¸­æ–­åå¯ç»§ç»­æœªå®Œæˆçš„ä»»åŠ¡
- **å¹‚ç­‰æ€§ä¿è¯**ï¼šé¿å…é‡å¤æ‰§è¡Œç›¸åŒæ“ä½œ

#### å®æ—¶é¢„è§ˆåŠŸèƒ½
- åº”ç”¨è§„åˆ™å‰é¢„è§ˆæ‰€æœ‰å˜æ›´
- æ¸…æ™°å¯¹æ¯”åŸåç§°ä¸æ–°åç§°
- å³æ—¶è°ƒæ•´è§„åˆ™å‚æ•°ï¼Œæ‰€è§å³æ‰€å¾—

#### å†²çªæ£€æµ‹
- è‡ªåŠ¨æ£€æµ‹é‡åå†²çª
- æ™ºèƒ½æç¤ºæ½œåœ¨é—®é¢˜
- ä¿æŠ¤æ–‡ä»¶å®‰å…¨

### ğŸ”’ éšç§ä¿æŠ¤

- **100% æœ¬åœ°å¤„ç†**ï¼šæ‰€æœ‰é‡å‘½åæ“ä½œåœ¨æµè§ˆå™¨æœ¬åœ°å®Œæˆ
- **æ— æ•°æ®ä¸Šä¼ **ï¼šä¸æ”¶é›†ã€ä¸ä¼ è¾“ä»»ä½•ç”¨æˆ·æ•°æ®
- **é€æ˜æ“ä½œ**ï¼šå¼€æºä»£ç ï¼Œå®Œå…¨å¯å®¡è®¡

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- **Node.js** >= 18.0
- **npm** >= 9.0
- **Chrome/Edge æµè§ˆå™¨** >= 110

### å®‰è£…æ­¥éª¤

#### 1. å…‹éš†é¡¹ç›®

```bash
git clone https:///lhly/cloud-drive-renamer.git
cd cloud-drive-renamer
```

#### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

#### 3. æ„å»ºæ‰©å±•

```bash
# å¼€å‘æ¨¡å¼ï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
npm run dev

# ç”Ÿäº§æ„å»º
npm run build
```

#### 4. åŠ è½½åˆ°æµè§ˆå™¨

1. æ‰“å¼€ Chrome æµè§ˆå™¨
2. è®¿é—® `chrome://extensions/`
3. å¯ç”¨å³ä¸Šè§’çš„ **"å¼€å‘è€…æ¨¡å¼"**
4. ç‚¹å‡» **"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"**
5. é€‰æ‹©é¡¹ç›®çš„ `dist` ç›®å½•
6. æ‰©å±•å®‰è£…å®Œæˆï¼

### å¿«é€ŸéªŒè¯

è®¿é—® [å¤¸å…‹ç½‘ç›˜](https://pan.quark.cn/list#/list/all)ï¼Œé€‰æ‹©æ–‡ä»¶ååº”èƒ½çœ‹åˆ°æ‰¹é‡é‡å‘½åæŒ‰é’®ã€‚

---

## ğŸ“˜ ä½¿ç”¨æŒ‡å—

### åŸºç¡€ä½¿ç”¨æµç¨‹

#### 1. æ‰“å¼€äº‘ç›˜é¡µé¢
è®¿é—®æ”¯æŒçš„äº‘ç›˜å¹³å°ï¼ˆå¦‚å¤¸å…‹ç½‘ç›˜ï¼‰ã€‚

#### 2. é€‰æ‹©æ–‡ä»¶
å‹¾é€‰éœ€è¦é‡å‘½åçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ã€‚

#### 3. ç‚¹å‡»é‡å‘½åæŒ‰é’®
åœ¨å·¥å…·æ æˆ–æµ®åŠ¨æŒ‰é’®ä¸­æ‰¾åˆ°æ‰¹é‡é‡å‘½ååŠŸèƒ½ã€‚

#### 4. é…ç½®è§„åˆ™
é€‰æ‹©é‡å‘½åè§„åˆ™ç±»å‹å¹¶è®¾ç½®å‚æ•°ã€‚

#### 5. é¢„è§ˆç»“æœ
æŸ¥çœ‹é¢„è§ˆåˆ—è¡¨ï¼Œç¡®è®¤æ‰€æœ‰å˜æ›´ç¬¦åˆé¢„æœŸã€‚

#### 6. æ‰§è¡Œé‡å‘½å
ç‚¹å‡»ç¡®è®¤æŒ‰é’®ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‰¹é‡æ‰§è¡Œã€‚

### å®æˆ˜ç¤ºä¾‹

#### ç¤ºä¾‹ 1ï¼šæ•´ç†ç…§ç‰‡é›†
**åœºæ™¯**ï¼šä¸ºæ—…è¡Œç…§ç‰‡æ·»åŠ ç»Ÿä¸€å‰ç¼€å’Œç¼–å·

```
åŸåç§°ï¼šIMG_001.jpg, IMG_002.jpg, IMG_003.jpg
è§„åˆ™ç»„åˆï¼š
  1. å‰ç¼€è§„åˆ™ï¼šprefix="Tokyo2025_"
  2. ç¼–å·è§„åˆ™ï¼šstartNumber=1, digits=3, position="suffix"
ç»“æœï¼šTokyo2025_001.jpg, Tokyo2025_002.jpg, Tokyo2025_003.jpg
```

#### ç¤ºä¾‹ 2ï¼šæ¸…ç†æ–‡æ¡£å‘½å
**åœºæ™¯**ï¼šç§»é™¤ç‰¹æ®Šå­—ç¬¦å¹¶ç»Ÿä¸€æ ¼å¼

```
åŸåç§°ï¼šæŠ¥å‘Š@2024#æœ€ç»ˆç‰ˆ.docx
è§„åˆ™ç»„åˆï¼š
  1. æ¸…ç†è§„åˆ™ï¼šremoveChars="@#"
  2. æ›¿æ¢è§„åˆ™ï¼šsearch="æœ€ç»ˆç‰ˆ", replace="Final"
ç»“æœï¼šæŠ¥å‘Š2024Final.docx
```

#### ç¤ºä¾‹ 3ï¼šç‰ˆæœ¬ç®¡ç†
**åœºæ™¯**ï¼šä¸ºé¡¹ç›®æ–‡ä»¶æ·»åŠ ç‰ˆæœ¬åç¼€

```
åŸåç§°ï¼šdesign.psd, mockup.fig, prototype.xd
è§„åˆ™ï¼šåç¼€è§„åˆ™ï¼šsuffix="_v2", separator=""
ç»“æœï¼šdesign_v2.psd, mockup_v2.fig, prototype_v2.xd
```

### é«˜çº§æŠ€å·§

#### è§„åˆ™ç»„åˆä½¿ç”¨
å¤šä¸ªè§„åˆ™å¯ä»¥å åŠ åº”ç”¨ï¼Œæ‰§è¡Œé¡ºåºä¸ºé…ç½®é¡ºåºï¼š

```typescript
// ç»„åˆç¤ºä¾‹
[
  { type: 'sanitize', params: { removeIllegal: true } },
  { type: 'prefix', params: { prefix: 'Project_' } },
  { type: 'numbering', params: { startNumber: 1, digits: 2 } }
]
```

#### æ ¼å¼åŒ–æ¨¡æ¿
ç¼–å·è§„åˆ™æ”¯æŒè‡ªå®šä¹‰æ ¼å¼åŒ–ï¼š

```typescript
format: "[{n}]"     // â†’ [001], [002]
format: "No.{n}"    // â†’ No.001, No.002
format: "{n}ë²ˆ"     // â†’ 001ë²ˆ, 002ë²ˆ
```

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Chrome Extension                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Popup     â”‚      â”‚  Background â”‚      â”‚
â”‚  â”‚    UI       â”‚â—„â”€â”€â”€â”€â–ºâ”‚   Service   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   Worker    â”‚      â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â–²                    â–²             â”‚
â”‚         â”‚                    â”‚             â”‚
â”‚         â–¼                    â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚      Content Script              â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚
â”‚  â”‚  â”‚ UI Components  Rule Engine â”‚ â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚      â”‚
â”‚  â”‚  â”‚   Platform Adapters       â”‚   â”‚      â”‚
â”‚  â”‚  â”‚  â€¢ Quark  â€¢ Aliyun â€¢ Baiduâ”‚   â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                   â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Cloud Drive API  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¨¡å—

#### 1. è§„åˆ™å¼•æ“ (Rule Engine)
- **èŒè´£**ï¼šè§„åˆ™è§£æã€éªŒè¯ã€æ‰§è¡Œ
- **ä½ç½®**ï¼š`src/rules/`
- **å…³é”®ç±»**ï¼š
  - `RuleFactory`ï¼šè§„åˆ™å·¥å‚ï¼Œåˆ›å»ºè§„åˆ™å®ä¾‹
  - `BaseRule`ï¼šè§„åˆ™åŸºç±»ï¼Œå®šä¹‰é€šç”¨æ¥å£
  - å…·ä½“è§„åˆ™å®ç°ï¼š`ReplaceRule`, `PrefixRule`, ç­‰

#### 2. å¹³å°é€‚é…å™¨ (Platform Adapters)
- **èŒè´£**ï¼šå°è£…ä¸åŒå¹³å°çš„ API è°ƒç”¨
- **ä½ç½®**ï¼š`src/adapters/`
- **è®¾è®¡æ¨¡å¼**ï¼šé€‚é…å™¨æ¨¡å¼
- **æ‰©å±•æ€§**ï¼šæ–°å¹³å°åªéœ€å®ç° `PlatformAdapter` æ¥å£

#### 3. æ‰§è¡Œå¼•æ“ (Executor)
- **èŒè´£**ï¼šæ‰¹é‡ä»»åŠ¡è°ƒåº¦ã€é€Ÿç‡æ§åˆ¶ã€é”™è¯¯å¤„ç†
- **ä½ç½®**ï¼š`src/core/executor.ts`
- **ç‰¹æ€§**ï¼š
  - ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†
  - é€Ÿç‡é™åˆ¶ (Rate Limiting)
  - é‡è¯•ç­–ç•¥ (Retry Policy)
  - å´©æºƒæ¢å¤ (Crash Recovery)

#### 4. UI ç»„ä»¶ (UI Components)
- **æŠ€æœ¯æ ˆ**ï¼šLit Web Components
- **ä½ç½®**ï¼š`src/content/components/`
- **ç»„ä»¶**ï¼š
  - `rename-dialog`ï¼šä¸»é‡å‘½åå¯¹è¯æ¡†
  - `rename-preview`ï¼šé¢„è§ˆåˆ—è¡¨
  - `progress-dialog`ï¼šè¿›åº¦è¿½è¸ª
  - `floating-button`ï¼šæµ®åŠ¨è§¦å‘æŒ‰é’®

### é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ types/              # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ rule.ts         # è§„åˆ™ç±»å‹
â”‚   â”œâ”€â”€ platform.ts     # å¹³å°æ¥å£
â”‚   â”œâ”€â”€ core.ts         # æ ¸å¿ƒç±»å‹
â”‚   â””â”€â”€ message.ts      # æ¶ˆæ¯ç±»å‹
â”œâ”€â”€ background/         # Background Service Worker
â”‚   â””â”€â”€ service-worker.ts
â”œâ”€â”€ content/            # Content Scripts
â”‚   â”œâ”€â”€ index.ts        # å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ components/     # Lit Web Components
â”‚       â”œâ”€â”€ rename-dialog.ts
â”‚       â”œâ”€â”€ rename-preview.ts
â”‚       â”œâ”€â”€ progress-dialog.ts
â”‚       â””â”€â”€ floating-button.ts
â”œâ”€â”€ adapters/           # å¹³å°é€‚é…å™¨
â”‚   â”œâ”€â”€ base/           # é€‚é…å™¨åŸºç±»å’Œæ¥å£
â”‚   â”‚   â””â”€â”€ adapter.interface.ts
â”‚   â”œâ”€â”€ quark/          # å¤¸å…‹ç½‘ç›˜é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ quark.ts
â”‚   â”‚   â””â”€â”€ errors.ts
â”‚   â”œâ”€â”€ aliyun/         # é˜¿é‡Œäº‘ç›˜ï¼ˆè§„åˆ’ä¸­ï¼‰
â”‚   â””â”€â”€ baidu/          # ç™¾åº¦ç½‘ç›˜ï¼ˆè§„åˆ’ä¸­ï¼‰
â”œâ”€â”€ rules/              # é‡å‘½åè§„åˆ™
â”‚   â”œâ”€â”€ base-rule.ts    # è§„åˆ™åŸºç±»
â”‚   â”œâ”€â”€ rule-factory.ts # è§„åˆ™å·¥å‚
â”‚   â”œâ”€â”€ replace.ts      # æ›¿æ¢è§„åˆ™
â”‚   â”œâ”€â”€ prefix.ts       # å‰ç¼€è§„åˆ™
â”‚   â”œâ”€â”€ suffix.ts       # åç¼€è§„åˆ™
â”‚   â”œâ”€â”€ numbering.ts    # ç¼–å·è§„åˆ™
â”‚   â””â”€â”€ sanitize.ts     # æ¸…ç†è§„åˆ™
â”œâ”€â”€ core/               # æ ¸å¿ƒå¼•æ“
â”‚   â”œâ”€â”€ executor.ts     # æ‰¹é‡æ‰§è¡Œå¼•æ“
â”‚   â”œâ”€â”€ retry.ts        # é‡è¯•æœºåˆ¶
â”‚   â”œâ”€â”€ crash-recovery.ts # å´©æºƒæ¢å¤
â”‚   â””â”€â”€ conflict-detector.ts # å†²çªæ£€æµ‹
â”œâ”€â”€ popup/              # Popup ç•Œé¢
â”‚   â”œâ”€â”€ popup.ts
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ dialog/             # ç‹¬ç«‹å¯¹è¯æ¡†é¡µé¢
â”‚   â””â”€â”€ dialog.ts
â””â”€â”€ utils/              # å·¥å…·å‡½æ•°
    â”œâ”€â”€ storage.ts      # å­˜å‚¨æŠ½è±¡
    â”œâ”€â”€ logger.ts       # æ—¥å¿—ç³»ç»Ÿ
    â””â”€â”€ helpers.ts      # è¾…åŠ©å‡½æ•°
```

### æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| è¯­è¨€ | TypeScript | 5.3+ | ç±»å‹å®‰å…¨çš„å¼€å‘ä½“éªŒ |
| æ„å»º | Vite | 5.0+ | å¿«é€Ÿæ„å»ºå’Œçƒ­é‡è½½ |
| UIæ¡†æ¶ | Lit | 3.1+ | è½»é‡çº§ Web Components |
| æ‰“åŒ… | @crxjs/vite-plugin | 2.3+ | Chrome æ‰©å±•ä¸“ç”¨æ‰“åŒ… |
| æµ‹è¯• | Vitest + Playwright | 1.6+ | å•å…ƒæµ‹è¯•å’ŒE2Eæµ‹è¯• |
| ä»£ç è´¨é‡ | ESLint + Prettier | æœ€æ–° | ä»£ç è§„èŒƒå’Œæ ¼å¼åŒ– |

---

## ğŸ› ï¸ äºŒæ¬¡å¼€å‘

### å¼€å‘ç¯å¢ƒé…ç½®

#### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

#### 2. å¯åŠ¨å¼€å‘æ¨¡å¼

```bash
npm run dev
```

å¼€å‘æ¨¡å¼æ”¯æŒçƒ­é‡è½½ï¼Œä¿®æ”¹ä»£ç åè‡ªåŠ¨é‡æ–°æ„å»ºã€‚

#### 3. ä»£ç è´¨é‡æ£€æŸ¥

```bash
# ä»£ç è§„èŒƒæ£€æŸ¥
npm run lint

# è‡ªåŠ¨ä¿®å¤ä»£ç é—®é¢˜
npm run lint:fix

# æ ¼å¼åŒ–ä»£ç 
npm run format

# TypeScript ç±»å‹æ£€æŸ¥
npm run typecheck
```

#### 4. è¿è¡Œæµ‹è¯•

```bash
# å•å…ƒæµ‹è¯•
npm test

# æµ‹è¯•è¦†ç›–ç‡
npm run test:coverage

# E2E æµ‹è¯•
npm run test:e2e

# E2E æµ‹è¯•ï¼ˆå¯è§†åŒ–æ¨¡å¼ï¼‰
npm run test:e2e:ui
```

### æ‰©å±•æ–°å¹³å°

#### å®ç°å¹³å°é€‚é…å™¨

1. åœ¨ `src/adapters/` ä¸‹åˆ›å»ºæ–°å¹³å°ç›®å½•
2. å®ç° `PlatformAdapter` æ¥å£

```typescript
// src/adapters/newplatform/newplatform.ts

import { PlatformAdapter } from '../base/adapter.interface';
import { FileItem } from '../../types/platform';

export class NewPlatformAdapter implements PlatformAdapter {
  // è·å–å½“å‰é€‰ä¸­çš„æ–‡ä»¶åˆ—è¡¨
  async getSelectedFiles(): Promise<FileItem[]> {
    // TODO: å®ç°æ–‡ä»¶åˆ—è¡¨è·å–é€»è¾‘
  }

  // æ‰§è¡Œé‡å‘½åæ“ä½œ
  async renameFile(fileId: string, newName: string): Promise<void> {
    // TODO: å®ç°é‡å‘½å API è°ƒç”¨
  }

  // éªŒè¯æ–‡ä»¶ååˆæ³•æ€§
  validateFileName(fileName: string): boolean {
    // TODO: å®ç°æ–‡ä»¶åéªŒè¯è§„åˆ™
  }

  // æ£€æµ‹å½“å‰æ˜¯å¦åœ¨ç›®æ ‡å¹³å°é¡µé¢
  isCurrentPlatform(): boolean {
    return window.location.hostname === 'newplatform.com';
  }
}
```

#### æ³¨å†Œå¹³å°é€‚é…å™¨

åœ¨ `manifest.json` ä¸­æ·»åŠ  content script é…ç½®ï¼š

```json
{
  "content_scripts": [
    {
      "matches": ["https://newplatform.com/*"],
      "js": ["src/content/index.ts"],
      "run_at": "document_idle"
    }
  ],
  "host_permissions": [
    "https://newplatform.com/*"
  ]
}
```

### æ·»åŠ æ–°è§„åˆ™

#### å®ç°è§„åˆ™ç±»

```typescript
// src/rules/custom-rule.ts

import { BaseRule } from './base-rule';

export interface CustomRuleParams {
  // å®šä¹‰è§„åˆ™å‚æ•°
  paramA: string;
  paramB: number;
}

export class CustomRule extends BaseRule {
  constructor(private params: CustomRuleParams) {
    super();
  }

  execute(fileName: string, index: number, total: number): string {
    // TODO: å®ç°è§„åˆ™é€»è¾‘
    return fileName; // è¿”å›å¤„ç†åçš„æ–‡ä»¶å
  }

  validate(config: CustomRuleParams): boolean {
    // TODO: å®ç°å‚æ•°éªŒè¯
    return true;
  }
}
```

#### æ³¨å†Œåˆ°è§„åˆ™å·¥å‚

```typescript
// src/rules/rule-factory.ts

import { CustomRule } from './custom-rule';

export class RuleFactory {
  static create(config: RuleConfig): RuleExecutor {
    switch (config.type) {
      // ... å…¶ä»–è§„åˆ™
      case 'custom':
        return new CustomRule(config.params as any);
      default:
        throw new Error(`Unknown rule type: ${config.type}`);
    }
  }
}
```

#### æ›´æ–°ç±»å‹å®šä¹‰

```typescript
// src/types/rule.ts

export type RuleType =
  | 'replace'
  | 'prefix'
  | 'suffix'
  | 'numbering'
  | 'sanitize'
  | 'custom'; // æ·»åŠ æ–°è§„åˆ™ç±»å‹
```

### è°ƒè¯•æŠ€å·§

#### 1. Chrome DevTools

```typescript
// åœ¨ä»£ç ä¸­æ·»åŠ è°ƒè¯•ä¿¡æ¯
console.log('[CloudDrive Renamer]', data);
```

åœ¨ Chrome DevTools ä¸­å¯ä»¥çœ‹åˆ°æ‰€æœ‰æ—¥å¿—è¾“å‡ºã€‚

#### 2. ä½¿ç”¨æ–­ç‚¹

åœ¨ Chrome DevTools çš„ Sources é¢æ¿ä¸­ï¼Œå¯ä»¥ç›´æ¥åœ¨æ‰©å±•ä»£ç ä¸­è®¾ç½®æ–­ç‚¹ã€‚

#### 3. æŸ¥çœ‹æ‰©å±•çŠ¶æ€

è®¿é—® `chrome://extensions/` å¯ä»¥æŸ¥çœ‹æ‰©å±•åŠ è½½çŠ¶æ€ã€é”™è¯¯ä¿¡æ¯ã€æƒé™ç­‰ã€‚

#### 4. çƒ­é‡è½½

å¼€å‘æ¨¡å¼ä¸‹ä¿®æ”¹ä»£ç åï¼š
1. ä»£ç è‡ªåŠ¨é‡æ–°æ„å»º
2. åœ¨ `chrome://extensions/` ç‚¹å‡»åˆ·æ–°æŒ‰é’®
3. åˆ·æ–°ç›®æ ‡ç½‘é¡µå³å¯çœ‹åˆ°å˜æ›´

### ä»£ç è§„èŒƒ

#### TypeScript è§„èŒƒ

- æ‰€æœ‰å…¬å…± API å¿…é¡»æœ‰ç±»å‹æ³¨è§£
- ä¼˜å…ˆä½¿ç”¨ `interface` è€Œé `type`
- ä½¿ç”¨ä¸¥æ ¼çš„ `tsconfig.json` é…ç½®

#### å‘½åè§„èŒƒ

- ç±»åï¼šPascalCaseï¼ˆå¦‚ `RuleFactory`ï¼‰
- æ–¹æ³•åï¼šcamelCaseï¼ˆå¦‚ `getSelectedFiles`ï¼‰
- å¸¸é‡ï¼šUPPER_SNAKE_CASEï¼ˆå¦‚ `MAX_RETRY_COUNT`ï¼‰
- æ–‡ä»¶åï¼škebab-caseï¼ˆå¦‚ `rule-factory.ts`ï¼‰

#### æ³¨é‡Šè§„èŒƒ

```typescript
/**
 * è§„åˆ™å·¥å‚ç±»
 * è´Ÿè´£æ ¹æ®é…ç½®åˆ›å»ºå¯¹åº”çš„è§„åˆ™å®ä¾‹
 */
export class RuleFactory {
  /**
   * åˆ›å»ºè§„åˆ™å®ä¾‹
   * @param config - è§„åˆ™é…ç½®å¯¹è±¡
   * @returns è§„åˆ™æ‰§è¡Œå™¨å®ä¾‹
   * @throws {Error} å½“è§„åˆ™ç±»å‹æœªçŸ¥æ—¶æŠ›å‡ºé”™è¯¯
   */
  static create(config: RuleConfig): RuleExecutor {
    // ...
  }
}
```

### æµ‹è¯•æŒ‡å—

#### å•å…ƒæµ‹è¯•ç¤ºä¾‹

```typescript
// src/rules/__tests__/prefix-rule.test.ts

import { describe, it, expect } from 'vitest';
import { PrefixRule } from '../prefix';

describe('PrefixRule', () => {
  it('should add prefix to filename', () => {
    const rule = new PrefixRule({ prefix: 'test_' });
    const result = rule.execute('file.txt', 0, 1);
    expect(result).toBe('test_file.txt');
  });

  it('should add prefix with separator', () => {
    const rule = new PrefixRule({
      prefix: 'test',
      separator: '-'
    });
    const result = rule.execute('file.txt', 0, 1);
    expect(result).toBe('test-file.txt');
  });
});
```

#### E2E æµ‹è¯•ç¤ºä¾‹

```typescript
// tests/e2e/rename.spec.ts

import { test, expect } from '@playwright/test';

test('should rename files on Quark drive', async ({ page }) => {
  await page.goto('https://pan.quark.cn/list#/list/all');

  // é€‰æ‹©æ–‡ä»¶
  await page.click('.file-checkbox');

  // æ‰“å¼€é‡å‘½åå¯¹è¯æ¡†
  await page.click('.rename-button');

  // é…ç½®è§„åˆ™
  await page.fill('#prefix-input', 'test_');

  // é¢„è§ˆ
  await page.click('.preview-button');
  await expect(page.locator('.preview-item')).toContainText('test_');

  // æ‰§è¡Œ
  await page.click('.execute-button');
  await expect(page.locator('.success-message')).toBeVisible();
});
```

### è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ï¼

#### æäº¤ Issue

- Bug æŠ¥å‘Šï¼šè¯¦ç»†æè¿°å¤ç°æ­¥éª¤å’Œç¯å¢ƒä¿¡æ¯
- åŠŸèƒ½å»ºè®®ï¼šè¯´æ˜ä½¿ç”¨åœºæ™¯å’Œé¢„æœŸæ•ˆæœ
- æ–‡æ¡£æ”¹è¿›ï¼šæŒ‡å‡ºä¸æ¸…æ¥šæˆ–æœ‰è¯¯çš„åœ°æ–¹

#### æäº¤ Pull Request

1. Fork é¡¹ç›®ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ï¼š`git checkout -b feature/amazing-feature`
3. æäº¤å˜æ›´ï¼š`git commit -m 'Add amazing feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/amazing-feature`
5. æäº¤ Pull Request

**PR è¦æ±‚**ï¼š
- é€šè¿‡æ‰€æœ‰æµ‹è¯•ï¼š`npm test`
- ä»£ç è§„èŒƒæ£€æŸ¥ï¼š`npm run lint`
- æ·»åŠ å¿…è¦çš„æµ‹è¯•ç”¨ä¾‹
- æ›´æ–°ç›¸å…³æ–‡æ¡£

---

## â“ å¸¸è§é—®é¢˜

### å®‰è£…å’Œä½¿ç”¨

**Q: ä¸ºä»€ä¹ˆå®‰è£…åæ‰¾ä¸åˆ°é‡å‘½åæŒ‰é’®ï¼Ÿ**

A: è¯·æ£€æŸ¥ï¼š
1. æ‰©å±•æ˜¯å¦æ­£ç¡®åŠ è½½ï¼ˆè®¿é—® `chrome://extensions/` ç¡®è®¤ï¼‰
2. æ˜¯å¦è®¿é—®äº†æ”¯æŒçš„ç½‘ç›˜å¹³å°
3. æ˜¯å¦é€‰ä¸­äº†æ–‡ä»¶
4. åˆ·æ–°é¡µé¢åé‡è¯•

**Q: ä¸ºä»€ä¹ˆé‡å‘½åå¤±è´¥ï¼Ÿ**

A: å¯èƒ½çš„åŸå› ï¼š
1. ç½‘ç»œè¿æ¥é—®é¢˜
2. æ–°æ–‡ä»¶åä¸ç°æœ‰æ–‡ä»¶å†²çª
3. æ–‡ä»¶ååŒ…å«éæ³•å­—ç¬¦
4. äº‘ç›˜ API é™æµ

è§£å†³æ–¹æ¡ˆï¼šæ‰©å±•ä¼šè‡ªåŠ¨é‡è¯•ï¼Œå¦‚æœæŒç»­å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—ã€‚

**Q: æ˜¯å¦æ”¯æŒæ–‡ä»¶å¤¹é‡å‘½åï¼Ÿ**

A: ç›®å‰ç‰ˆæœ¬æ”¯æŒæ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„æ‰¹é‡é‡å‘½åã€‚

### éšç§å’Œå®‰å…¨

**Q: æ‰©å±•ä¼šä¸Šä¼ æˆ‘çš„æ–‡ä»¶åæˆ–æ•°æ®å—ï¼Ÿ**

A: ä¸ä¼šã€‚æ‰€æœ‰å¤„ç†éƒ½åœ¨æœ¬åœ°å®Œæˆï¼Œä¸ä¼šå‘ä»»ä½•ç¬¬ä¸‰æ–¹æœåŠ¡å™¨å‘é€æ•°æ®ã€‚

**Q: ä¸ºä»€ä¹ˆéœ€è¦å­˜å‚¨æƒé™ï¼Ÿ**

A: ç”¨äºä¿å­˜ç”¨æˆ·çš„è§„åˆ™é…ç½®å’Œå´©æºƒæ¢å¤æ•°æ®ï¼Œæ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°ã€‚

**Q: ä¸ºä»€ä¹ˆéœ€è¦è®¿é—®äº‘ç›˜ç½‘ç«™çš„æƒé™ï¼Ÿ**

A: æ‰©å±•éœ€è¦åœ¨äº‘ç›˜é¡µé¢æ³¨å…¥ UI ç»„ä»¶å’Œè°ƒç”¨äº‘ç›˜ APIï¼Œè¿™äº›éƒ½åœ¨æµè§ˆå™¨æ²™ç®±ç¯å¢ƒä¸­è¿è¡Œã€‚

### å¼€å‘ç›¸å…³

**Q: å¦‚ä½•æ·»åŠ å¯¹æ–°äº‘ç›˜å¹³å°çš„æ”¯æŒï¼Ÿ**

A: è¯·å‚è€ƒ [æ‰©å±•æ–°å¹³å°](#æ‰©å±•æ–°å¹³å°) ç« èŠ‚ã€‚

**Q: å¦‚ä½•è´¡çŒ®ä»£ç ï¼Ÿ**

A: è¯·å‚è€ƒ [è´¡çŒ®æŒ‡å—](#è´¡çŒ®æŒ‡å—) ç« èŠ‚ã€‚

**Q: é‡åˆ° Bug å¦‚ä½•æŠ¥å‘Šï¼Ÿ**

A: è¯·åœ¨ GitHub Issues ä¸­æäº¤ï¼ŒåŒ…å«ï¼š
- æµè§ˆå™¨ç‰ˆæœ¬
- æ‰©å±•ç‰ˆæœ¬
- å¤ç°æ­¥éª¤
- é”™è¯¯æˆªå›¾æˆ–æ—¥å¿—

---

## ğŸ—ºï¸ è·¯çº¿å›¾

### å½“å‰ç‰ˆæœ¬ (v0.1.0)
- âœ… å¤¸å…‹ç½‘ç›˜æ”¯æŒ
- âœ… 5 ç§åŸºç¡€é‡å‘½åè§„åˆ™
- âœ… å®æ—¶é¢„è§ˆåŠŸèƒ½
- âœ… æ‰¹é‡æ‰§è¡Œå¼•æ“

### è®¡åˆ’ä¸­ (v0.2.0)
- ğŸ”„ é˜¿é‡Œäº‘ç›˜å®Œæ•´æ”¯æŒ
- ğŸ”„ ç™¾åº¦ç½‘ç›˜å®Œæ•´æ”¯æŒ
- ğŸ”„ è§„åˆ™æ¨¡æ¿ä¿å­˜ä¸åˆ†äº«
- ğŸ”„ å†å²è®°å½•å’Œæ’¤é”€åŠŸèƒ½

### æœªæ¥å±•æœ› (v1.0.0+)
- ğŸ“‹ æ­£åˆ™è¡¨è¾¾å¼è§„åˆ™
- ğŸ“‹ æ¡ä»¶è§„åˆ™ï¼ˆåŸºäºæ–‡ä»¶ç±»å‹/å¤§å°ï¼‰
- ğŸ“‹ æ‰¹é‡ä»»åŠ¡è°ƒåº¦

---

## ğŸ“„ è®¸å¯åè®®

æœ¬é¡¹ç›®åŸºäº [MIT License](LICENSE) å¼€æºã€‚

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œç”¨æˆ·çš„æ”¯æŒï¼

ç‰¹åˆ«æ„Ÿè°¢ï¼š
- [Lit](https://lit.dev/) - å‡ºè‰²çš„ Web Components æ¡†æ¶
- [Vite](https://vitejs.dev/) - æé€Ÿæ„å»ºå·¥å…·
- [CRXJS](https://crxjs.dev/) - Chrome æ‰©å±•å¼€å‘åˆ©å™¨

---

## ğŸ“ è”ç³»æˆ‘ä»¬

- **é—®é¢˜åé¦ˆ**ï¼š[GitHub Issues](https:///lhly/cloud-drive-renamer/issues)
- **åŠŸèƒ½å»ºè®®**ï¼š[GitHub Discussions](https://github.com/lhly/cloud-drive-renamer/discussions)
- **é‚®ä»¶è”ç³»**ï¼šlhlyzh@qq.com

---

<div align="center">

**å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª â­ï¸**

Made with â¤ï¸ by å†·ç«å‡‰çƒŸ

</div>
