# ==========================================
# GitHub Actions Workflow: Complete Test Suite
# ==========================================
#
# åŠŸèƒ½ï¼šè¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼ˆåŒ…æ‹¬æ€§èƒ½æµ‹è¯•ï¼‰
#
# è§¦å‘æ¡ä»¶ï¼š
#   - æ‰‹åŠ¨è§¦å‘
#   - æ¯å‘¨å®šæ—¶è¿è¡Œ
#   - Release æ ‡ç­¾
#
# æ—¶é•¿ï¼šçº¦ 5-10 åˆ†é’Ÿ
#
# ==========================================

name: Complete Tests

# è§¦å‘æ¡ä»¶
on:
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

  # æ¯å‘¨ä¸€æ—©ä¸Šè¿è¡Œ
  schedule:
    - cron: '0 0 * * 1'

  # Release æ ‡ç­¾è§¦å‘
  push:
    tags:
      - 'v*.*.*'

# ç¯å¢ƒå˜é‡
env:
  NODE_VERSION: '20'

jobs:
  complete-tests:
    name: Complete Test Suite
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ Install dependencies
        run: npm ci

      # è¿è¡Œæ‰€æœ‰å•å…ƒå’Œé›†æˆæµ‹è¯•
      - name: ğŸ§ª Run unit and integration tests
        run: npm run test:ci
        continue-on-error: false

      # è¿è¡Œæ€§èƒ½æµ‹è¯•
      - name: ğŸ“Š Run performance tests
        run: npm run test:performance
        continue-on-error: false

      # å¯é€‰ï¼šè¿è¡Œ E2E æµ‹è¯•
      # - name: ğŸ­ Run E2E tests
      #   run: npm run test:e2e
      #   continue-on-error: false

      - name: âœ… All tests completed
        run: echo "âœ… Complete test suite passed!"
