# ==========================================
# GitHub Actions Workflow: Complete Test Suite
# ==========================================
#
# åŠŸèƒ½ï¼šè¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼ˆåŒ…æ‹¬æ€§èƒ½æµ‹è¯•ï¼‰
#
# è§¦å‘æ¡ä»¶ï¼š
#   - æ‰‹åŠ¨è§¦å‘
#   - æ¯å‘¨å®šæ—¶è¿è¡Œ
#   - Release æ ‡ç­¾
#
# æ—¶é•¿ï¼šçº¦ 5-10 åˆ†é’Ÿ
#
# ==========================================

name: Complete Tests

# è§¦å‘æ¡ä»¶
on:
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

  # æ¯å‘¨ä¸€æ—©ä¸Šè¿è¡Œ
  schedule:
    - cron: '0 0 * * 1'

  # æ³¨æ„ï¼štag æ¨é€æ—¶åªè§¦å‘ release.yml
  # æœ¬å·¥ä½œæµä¸“ç”¨äºå®šæ—¶è¿è¡Œå’Œæ‰‹åŠ¨è§¦å‘

# ç¯å¢ƒå˜é‡
env:
  NODE_VERSION: '20'

jobs:
  complete-tests:
    name: Complete Test Suite
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ Install dependencies
        run: npm ci

      # è¿è¡Œå®Œæ•´çš„è´¨é‡æ£€æŸ¥å’Œæµ‹è¯•
      - name: ğŸš€ Run complete CI suite
        run: npm run ci
        continue-on-error: false

      # å¯é€‰ï¼šè¿è¡Œ E2E æµ‹è¯•
      - name: ğŸ­ Run E2E tests
        run: npm run test:e2e
        continue-on-error: true  # E2E æµ‹è¯•å¤±è´¥ä¸é˜»æ­¢æµç¨‹

      - name: âœ… All tests completed
        run: |
          echo "âœ… Complete test suite passed!"
          echo "- âœ… Quality checks (lint, typecheck, tests)"
          echo "- âœ… Build verification"
          echo "- ğŸ­ E2E tests (optional)"
